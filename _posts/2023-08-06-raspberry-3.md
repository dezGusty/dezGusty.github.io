---
layout: post
title: Raspberry PI - 3 ğŸ«
---

ÃncÄƒ un server web cu Raspberry PI 4. Primul deserveÈ™te o paginÄƒ staticÄƒ. Hai sÄƒ afiÈ™Äƒm È™i ceva mai dinamic. Am mai scris o aplicaÈ›ie web folosind ChatGPT È™i Rust: [rs-weight-tracker](https://github.com/dezGusty/rs-weight-tracker).

FoloseÈ™te tot Rust, deÈ™i un alt *crate*. Include È™i o bazÄƒ de date sqlite. Dar tot este simplÄƒ.
Hai sÄƒ vedem cum ar merge un deploy pe Raspberry PI 4.

## Build local

Sunt necesare niÈ™te dependinÈ›e suplimentare, care trebuie instalate Ã®n prealabil la nivel de sistem:

- sqlite3
- diesel

```sh
apt-get install libsqlite3-dev
cargo install diesel_cli --no-default-features --features sqlite
```

```sh
cd ~/work/
git clone <git@github.com>:dezGusty/rs-weight-tracker.git
cd rs-weight-tracker/
cargo build --release
diesel migration run
```

### Date extra (opÈ›ional)

Se pot importa È™i date suplimentare

```sh
cargo run --release --bin import_weights ./data/sample_data.json
```

#### Test 2 (OpÈ›ional)

De probÄƒ, un cargo run pentru a vedea.

```sh
cargo run
```

> CTRL + C pentru a opri aplicaÈ›ia

Ok, ce se vede? Unde ?
PÄƒi hai sÄƒ ne conectÄƒm la VNC (de repornit serverul vnc dacÄƒ e nevoie)

```sh
vncserver
```

È˜i Ã®ntr-un browser pornit din Raspberry PI via VNC, ar trebui sÄƒ meargÄƒ apelat serverul web (<http://127.0.0.1:14280>)
AplicaÈ›ia gse ar trebui sÄƒ fie configuratÄƒ sÄƒ ruleze pe portul 14280 din oficiu.

#### Sub-config 2 (OpÈ›ional)

DacÄƒ e ceva ce se actualizeazÄƒ mai des, cÃ¢t este activ web server-ul, nu va merge recompilat codul.
Pentru a permite È™i scenariul Äƒsta, ar fi bine sÄƒ existe un director dedicat deploy-ului, de unde sÄƒ se execute binarele.

```sh
mkdir /home/PIUSER/work/deploy
mkdir /home/PIUSER/work/deploy/rs-weight-tracker
cp -r /home/PIUSER/work/rs-weight-tracker/target/release/* /home/PIUSER/work/deploy/rs-weight-tracker/
```

## Al 2-lea web server, ca serviciu

(tot bazat pe exemplul de aici: <https://www.shellhacks.com/systemd-service-file-example/>)

## Configure the daemon

Based on tutorial <https://www.shellhacks.com/systemd-service-file-example/>

```sh
sudo touch /etc/systemd/system/rs-weight-tracker.service
sudo chmod 664 /etc/systemd/system/rs-weight-tracker.service
sudo nano /etc/systemd/system/rs-weight-tracker.service
```

De setat conÈ›inutul configurÄƒrii serviciului (presupun existenÈ›a directorului *deploy*)

```ini
[Unit]
Description=rs-weight-tracker web service
After=network.target

[Service]
Type=simple
User=PIUSER
ExecStart=/home/PIUSER/work/deploy/rs-weight-tracker/rs-weight-tracker
Restart=always
RestartSec=2
TimeoutStartSec=0
WorkingDirectory=/home/PIUSER/work/rs-weight-tracker

[Install]
WantedBy=multi-user.target
```

```sh
sudo systemctl enable rs-weight-tracker
sudo systemctl start rs-weight-tracker
```

## Ce a vrut sÄƒ spunÄƒ autorul

Am fÄƒcut o aplicaÈ›ie web cu ChatGPT.  
Se poate instala pe un Raspberry Pi 4.
