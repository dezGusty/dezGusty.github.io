---
layout: post
title: Raspberry PI - 5 ğŸ‘
---

Ok, dacÄƒ tot e un web server, sÄƒ fie pe web, nu ?
NecesitÄƒ È™i un nume de domeniu. Deci trebuie mers la un *registrar* (de exemplu <https://www.globehosting.com/>), È™i cumpÄƒrat un domeniu disponibil (de exemplu `www.gigel.net` e luat din pÄƒcate, dar `www.muculm.eu` e disponibil).

## Un reverse-proxy

Apoi, pentru a ne conecta domeniul la site-ul gÄƒzduit pe Raspberry PI, o variantÄƒ la Ã®ndemÃ¢nÄƒ este de folosire a unui reverse proxy.
Cea mai convenabilÄƒ soluÈ›ie Ã®n momentul de faÈ›Äƒ pare sÄƒ fie cea de la [CloudFlare](https://www.cloudflare.com/learning/cdn/glossary/reverse-proxy/).

Se apeleazÄƒ de aici: <https://dash.cloudflare.com/>. È˜i existÄƒ tutoriale mai detaliate, precum: <https://pimylifeup.com/raspberry-pi-cloudflare-tunnel/>.

De pe PI, se instaleazÄƒ `cloudflared`:

```sh
sudo apt install curl lsb-release
curl -L https://pkg.cloudflare.com/cloudflare-main.gpg | sudo tee /usr/share/keyrings/cloudflare-archive-keyring.gpg >/dev/null
echo "deb [signed-by=/usr/share/keyrings/cloudflare-archive-keyring.gpg] https://pkg.cloudflare.com/cloudflared $(lsb_release -cs) main" | sudo tee  /etc/apt/sources.list.d/cloudflared.list
sudo apt update
sudo apt install cloudflared
```

Apoi este necesarÄƒ autentificarea de pe PI. Posibil sÄƒ fie nevoie de deschiderea unui link web pe computerul principal.

```sh
cloudflared tunnel login
```

## La minerit

Trebuie creat un tunel, instrucÈ›iuni mai detaliate aici: (from <https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/install-and-setup/tunnel-guide/local/> ).

```sh
cloudflared tunnel create MUCTUNNEL
```

Consola ne va informa:

> Created tunnel MUCTUNNEL with id 12345678-abcd-1a2b-3c4d-13523423412x

```sh
cloudflared tunnel route dns MUCTUNNEL muculm.eu
cloudflared tunnel list
```

### Test (opÈ›ional)

Se lanseazÄƒ tunelul pe portul pe care ascultÄƒ nginx:

```sh
cloudflared tunnel run --url localhost:8088 MUCTUNNEL
```

Acum dacÄƒ se deschide un url Ã®n browser (de oriunde) pe domeniul folosit (de ex: <https://muculm.eu>), ar trebui sÄƒ se ajungÄƒ la site-ul gÄƒzduit pe Raspberry PI.

La final, se opreÈ™te tunelul.
> CTRL + C

## MutÄƒ configurarea Ã®ntr-un fiÈ™ier

Configurarea ar trebui sÄƒ fie Ã®ntr-un fiÈ™ier `yml`, ca sÄƒ putem executa un serviciu la fiecare pornire a Raspberry PI-ului (inclusiv cÃ¢nd se ia curentul, sau se scoate accidental cablul de alimentare din prizÄƒ pentru a pune aspiratorul).

```sh
cd /home/PIUSER/.cloudflared/
sudo touch config.yml
sudo nano config.yml
```

ConÈ›inutul fiÈ™ierului de configurare `config.yml` ar trebui sÄƒ semene cu

```yml
url: http://localhost:8088
tunnel: 12345678-abcd-1a2b-3c4d-13523423412x
credentials-file: /home/PIUSER/.cloudflared/12345678-abcd-1a2b-3c4d-13523423412x.json
ingress:
    - hostname: muculm.eu
      service: http://localhost:8088
    - service: http_status:404
```

Se poate folosi de probÄƒ comanda:

```sh
cloudflared tunnel --config /home/PIUSER/.cloudflared/config.yml run MUCTUNNEL
```

...È˜i deschide un url Ã®n browser cÄƒtre domeniul folosit.

> CTRL + C

## ConfigureazÄƒ ca serviciu

Make it a service

```sh
sudo cp config.yml /etc/cloudflared/config.yml
sudo cloudflared service install
sudo systemctl start cloudflared
systemctl status cloudflared
```

## Ce a vrut sÄƒ spunÄƒ autorul

Cu un reverse proxy, precum cloudflare se poate expune un site gÄƒzduit pe un Raspberry PI.
